<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŸå¸‚æ°”æ¸©å˜åŒ–å›¾</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 20px;
    background-color: #f7f7f7;
  }
  h1 {

    text-align: center;
  }

  #city-select {
    padding: 10px;
    margin-bottom: 50px;
    border-radius: 2px;
    border: 1px solid hsl(0, 0%, 87%);
    text-align: left; /* è®¾ç½®å¯¹é½ */
    float: left;
}
  #chart-container {
    position: relative;
    margin: auto;
    height: 40vh;
    width: 80vw;
    border: 2px solid rgb(194, 193, 193);
  }

  #kuo_zhan {
    position: relative;
    margin: auto;
    height: 40vh;
    width: 80vw;
    border: 2px solid rgb(194, 193, 193);
}
#info {
    padding: 10px;
    margin-bottom: 50px;
    border-radius: 2px;
    border: 1px solid hsl(0, 0%, 87%);
    float: left;
    /* display: inline-block; è‡ªé€‚åº”å†…å®¹å¤§å° */
}
.container {
    align-items: center; /* å‚ç›´å±…ä¸­ */
    height: 100vh; /* å¯æ ¹æ®éœ€è¦è°ƒæ•´çˆ¶å®¹å™¨é«˜åº¦ */
}

</style>
  <script src="/js/chart.js"></script>
</head>
<body>
  <h1>åŸå¸‚æ°”æ¸©å˜åŒ–å›¾</h1>
<div class="container">
  <div>
    <!-- ä¸‹æ‹‰æ¡†ç”¨äºé€‰æ‹©åŸå¸‚ -->
    <div>
      <select id="city-select">
      <!-- åŸå¸‚é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å……apiä¸º: -->
      </select>
    </div>
    <div>
      <!-- å›¾è¡¨å®¹å™¨ï¼Œå…¶ä¸­çš„canvasç”¨äºæ¸²æŸ“å›¾è¡¨ -->
      <div id="chart-container">
        <canvas id="weatherChart"></canvas>
      </div>
    </div>
  </div>

<h1>åŸå¸‚æ¹¿åº¦å˜åŒ–å›¾</h1>
  <div>
      <!-- å·¦è¾¹çš„ä¿¡æ¯æ  -->
    <div id="info">
      <a style="font-size: 1.5em; margin-bottom: 20px;" href="https://github.com/ShaogHong?tab=overview&from=2024-04-01&to=2024-04-05" target="_blank"><b>Github</b></a><br>
      <a style="font-size: 1.5em;" href="https://zzhanzhang.top" target="_blank"><b>æˆ‘çš„åšå®¢</b></a><br>
      <a style="font-size: 1.5em;" href="https://www.douyin.com/user/MS4wLjABAAAAoyJOQEi4CVTrQIbq0nlHLxGAnRtxYXtZ09fByiEC_RA" target="_blank"><b>ğŸŒä¸ªæœ‹å‹</b></a><br>
        <a style="font-size: 1.5em;" href="http://localhost:63342/py_mongoDB_work/phenomena.html" target="_blank"><b>å¤©æ°”æ¦‚è§ˆ</b></a>
    </div>

      <!-- æ‰©å±•åŒºåŸŸ -->
      <div id="kuo_zhan">
        <canvas id="humidityChart"></canvas>

      </div>
  </div>
</div>

<script>
// å®šä¹‰å…¨å±€å˜é‡ä»¥ä¾¿å¯ä»¥é”€æ¯æ—§å›¾å®ä¾‹
var weatherChart;
var humidityChart;

fetch('http://127.0.0.1:5000/get_all_citycode_and_name')
  .then(response => response.json())
  .then(data => {
    const select = document.getElementById('city-select');
    data.info.forEach(city => {
      const option = document.createElement('option');
      option.value = String(city.citycode);
      option.textContent = city.cityname;
      select.appendChild(option);
    });
  });

document.getElementById('city-select').addEventListener('change', function() {
  const citycode = this.value;
  const apiUrl = `http://127.0.0.1:5000/weather/${citycode}`;

  fetch(apiUrl)
    .then(response => response.json())
    .then(data => {
      const weatherLabels = [];
      const weatherData = [];
      const humidityLabels = [];
      const humidityData = [];

      data.history.forEach(entry => {
        if (entry.updatetime && entry.humidity) {
          weatherLabels.push(entry.updatetime);
          weatherData.push(entry.temperature);
          humidityLabels.push(entry.updatetime);
          humidityData.push(entry.humidity);
        }
      });

      if (weatherChart) {
        weatherChart.destroy();
      }
      if (humidityChart) {
        humidityChart.destroy();
      }
<!-- å¯è§†åŒ–æ¹¿åº¦jsä»£ç -->
      const weatherCtx = document.getElementById('weatherChart').getContext('2d');
      weatherChart = new Chart(weatherCtx, {
        type: 'line',
        data: {
          labels: weatherLabels,
          datasets: [{
            label: 'æ°”æ¸© (Â°C)',
            data: weatherData,
            fill: false,
            borderColor: 'blue',
            tension: 0.1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: false
            }
          },
          responsive: true,
          maintainAspectRatio: false
        }
      });

      const humidityCtx = document.getElementById('humidityChart').getContext('2d');
      humidityChart = new Chart(humidityCtx, {
        type: 'line',
        data: {
          labels: humidityLabels,
          datasets: [{
            label: 'æ¹¿åº¦',
            data: humidityData,
            fill: false,
            borderColor: 'green',
            tension: 0.1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          },
          responsive: true,
          maintainAspectRatio: false
        }
      });
    });
});
</script>

</body>
</html>